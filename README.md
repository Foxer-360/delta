# Delta

Package of custom "delta language" which allows us to create and edit web content using some incremental operations.

## Commands

There are some prepared useful commands for this project.

 - `yarn clean` which remove all compiled files (folder `lib`)
 - `yarn test` run all tests from folder `tests`
 - `yarn compile` to compile typescript into javascript
 - `yarn babel` to resolve aliases in imports and transform js into the compatible version
 - `yarn resolveDefs` to resolve aliases in definition files (folder `lib/@types`)
 - `yarn build` which do all steps to completly build project from typescript into a ready-to-use js library
 - `yarn rebuild` same as build, but before build it will call `yarn clean`

## Setting & Build Overview

This project is written in TypeScript (TS) which causes some problems with build. All codes are in `src` folder and all test are in `tests` folder. To make TS fully working also in `tests` folder, we need include this folder in `tsconfig.json`. But when we are in time of build, we want folder `src` as a root and ignore `tests` folder, so for this case, there is `tsconfig.build.json` config file, which just extends `tsconfig.json` and ignore `tests`. On the other side, when we want to test (using **jest**), we need add some extra config, so in this case, there is `tsconfig.test.json`. One of problematic TS config is **alias**. In this project, there is setup alias `@source` which points into `src` folder and this is set in `tsconfig.json`. This is all to TS configurations.

Now some words for build. As we are using `@source` alias, we need resolve `imports` into relative paths. TS can works with an alias, but compiled code from `tsc` is still using `@source` alias instead of resolved relative paths. For this purpose, there is **babel**, which takes compiled codes and resolve aliases into relative paths and also translate modern JS into the compatible version. But there is one more problem. Babel can't resolve definition files, generated by `tsc`.

So to resolve aliases in definition files into relative paths, there is script `resolveDefinitions.js` in `scripts` folder. And now everything together create build into `lib` folder, which is ready to use.

### Build flow

To build this project from TS into JS usable as a package in any other project we need to do a few steps.

 1. build ts code into js using `tsc`
 2. resolve aliases and transform JS into the compatible version using `babel`
 3. resolve aliases in definition files using `resolveDefinitions.js` script

## Git Large File Storage (Git LFS)

This repository uses **Git LFS**, to get more information about Git LFS, please visit [this website](https://git-lfs.github.com/). Git LFS is a plugin to git package, so you need to install this before you start using this repository.
This extension has a benefit with `non-code` large files like images, archives, etc. So if you add some file of this type into this repository, please make sure that this file is **tracked** by Git LFS. To show tracked files, you can use this command

`git lfs track`

You can tract files directly, or just files with some extension or files in some folder. For example if you want to track images with `.png` extension, you can do that by this command

`git lfs track *.png`
